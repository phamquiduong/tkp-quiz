{% extends "base.html" %}

{% block title %}
TKP Quiz | Lớp học
{% endblock title %}

{% block navigation %}
{% include 'teacher/navigation.html' with path='class_room' %}
{% endblock navigation %}

{% block main %}
<div class="container mb-5 d-flex">
  <form class="flex-grow-1">
    <div class="input-group">
      <input type="text" class="form-control text-center" placeholder="Tìm kiếm tên lớp học"
        name="class_room__name_filter" value="{{ class_room__name_filter|default:'' }}" id="searchClassRoomInput"
        autofocus>
      <button class="btn btn-primary" type="submit">
        <i class="fa-solid fa-magnifying-glass"></i>
      </button>
    </div>
  </form>

  <div class="ms-4">
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createClassRoomModal"
      id="createClassRoomShowModalBtn">Thêm mới
    </button>
  </div>
</div>

<div class="container py-4 rounded bg-body">
  {% if classes_room %}
  <h5 class="mb-4">Danh sách lớp học</h5>
  <table class="table table-hover">
    <thead>
      <tr class="align-middle">
        <th>ID</th>
        <th>Tên lớp học</th>
        <th class="fit-content">Danh sách</th>
        <th class="fit-content">Chỉnh sửa</th>
        <th class="fit-content">Xóa</th>
      </tr>
    </thead>
    <tbody class="load-fade">
      {% for class_room in classes_room %}
      <tr class="align-middle">
        <td>{{ class_room.id }}</td>
        <td>{{ class_room.name }}</td>
        <td class="fit-content">
          <a class="btn btn-primary" href="{% url 'teacher_class_room__student__list' class_room__id=class_room.id %}">
            <i class="fa-solid fa-user-group"></i>
          </a>
        </td>
        <td class="fit-content">
          <button type="button" class="btn btn-secondary"
            onclick="updateClassHandler(event, '/admin/authenticate/classroom/{{class_room.id}}/change/')">
            <i class="fa-solid fa-pen-to-square"></i>
          </button>
        </td>
        <td class="fit-content">
          <button type="button" class="btn btn-danger float-end delete-class-btn"
            onclick="deleteClassRoomHanlder(event, `{% url 'teacher_class_room__delete' class_room__id=class_room.id %}`, '{{class_room.name}}')">
            <i class="fa-solid fa-trash"></i>
          </button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <h6 class="text-center">Không có lớp học nào <i class="fa-solid fa-face-sad-tear"></i></h6>
  {% endif %}
</div>

<div class="modal fade" id="createClassRoomModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5">Thêm lớp học mới</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form class="needs-validation" method="POST" action="{% url 'teacher_class_room__list_create' %}">
          <div class="input-group mb-3">
            <span class="input-group-text" style="width: 115px;">Tên lớp học</span>
            <input type="text" class="form-control text-center" value="{{ form.name.value|default:'' }}" name="name"
              required>
          </div>
          {% include 'form.html' %}
          <button type="submit" style="display: none;" id="createClassRoomSubmitBtn"></button>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
        <button type="button" class="btn btn-primary"
          onclick="document.getElementById('createClassRoomSubmitBtn').click()">Thêm lớp học</button>
      </div>
    </div>
  </div>
</div>

<form style="display: none;" method="POST" id="deleteClassRoomForm">{% csrf_token %}</form>
<button data-bs-toggle="modal" data-bs-target="#deleteClassRoomModal" id="deleteClassRoomShowModalBtn"
  style="display: none;"></button>
<div class="modal fade" id="deleteClassRoomModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5">Xóa lớp học</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Bạn đang thực hiện lệnh xóa lớp "<span class="fw-medium" id="deleteClassRoomName"></span>"</p>
        <p>Sau khi thực hiện xong, bạn sẽ <mark>không thể khôi phục lại</mark> dữ liệu này nữa.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
        <button type="button" class="btn btn-danger" id="deleteClassRoomSubmitBtn">Xóa lớp học</button>
      </div>
    </div>
  </div>
</div>
{% endblock main %}

{% block style %}
<style>
  #searchClassRoomInput:focus {
    box-shadow: none;
  }
</style>
{% endblock style %}

{% block script %}
<script>
  // Update class handler
  const updateClassHandler = (event, url) => {
    event.stopPropagation()
    openWindowAndReloadPage(url)
  }

  // Delete class Handler
  var deleteClassRoomName = document.getElementById('deleteClassRoomName')
  var deleteClassRoomSubmitBtn = document.getElementById('deleteClassRoomSubmitBtn')
  var deleteClassRoomForm = document.getElementById('deleteClassRoomForm')
  var deleteClassRoomShowModalBtn = document.getElementById('deleteClassRoomShowModalBtn')
  const deleteClassRoomHanlder = (event, url, name) => {
    event.stopPropagation();
    deleteClassRoomName.innerHTML = name
    deleteClassRoomForm.action = url
    deleteClassRoomSubmitBtn.addEventListener("click", () => { deleteClassRoomForm.submit() })
    deleteClassRoomShowModalBtn.click()
  }
</script>

{% if form.errors %}
<script>document.getElementById('createClassRoomShowModalBtn').click()</script>
{% endif %}
{% endblock script %}
