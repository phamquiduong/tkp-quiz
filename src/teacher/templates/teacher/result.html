{% extends "base.html" %}

{% block title %}
Giáo viên - Kết quả thi
{% endblock title %}

{% block navigation %}
{% include 'teacher/navigation.html' with path='result' %}
{% endblock navigation %}

{% block main %}
<div class="container pt-4 pb-3 mb-4 mt-4 border rounded bg-body">
  <form class="input-group mb-4" method="GET">
    <select class="form-select text-center" name="class_room__id" required>
      <option disabled selected value id="class_room_default"> -- Lớp học -- </option>
      {% for class_room in class_rooms %}
      <option value="{{class_room.id}}" id="class_room_{{class_room.id}}">{{class_room.name}}</option>
      {% endfor %}
    </select>

    <select class="form-select text-center" name="contest__id" required>
      <option disabled selected value id="contest_default"> -- Cuộc thi -- </option>
      {% for contest in contests %}
      <option value="{{contest.id}}" id="contest_{{contest.id}}">{{contest.name}}</option>
      {% endfor %}
    </select>

    <input type="hidden" name="sort_by_point" id="sortByPointInput" value="false">

    <button type="submit" class="btn btn-primary" id="viewResultBtn">
      Xem kết quả <i class="fa-solid fa-magnifying-glass ms-2"></i>
    </button>
  </form>

  <hr>

  {% if results %}
  <div class="d-flex">
    <div class="flex-grow-1">
      <h5 class="mt-4 mb-3">Kết quả</h5>
    </div>
    <form class="d-flex align-self-center" method="POST">
      {% csrf_token %}
      <input type="hidden" name="class_room__id" value="{{class_room__id}}">
      <input type="hidden" name="contest__id" value="{{contest__id}}">
      <button type="submit" class="btn btn-secondary">Tải kết quả <i class="fa-solid fa-download"></i></button>
    </form>
  </div>

  <table class="table table-hover">
    <thead>
      <tr class="align-middle">
        <th>Email</th>
        <th>Họ và tên</th>
        <th class="text-center">Số câu đúng</th>
        <th class="text-center">
          <label>Điểm số</label>
          <button class="btn btn-sm ms-2" id="sortByPointBtn"><i class="fa-solid fa-sort"></i></button>
        </th>
      </tr>
    </thead>
    <tbody class="load-fade">
      {% for result in results %}
      <tr>
        <td>{{result.user.email}}</td>
        <td>{{result.user.full_name}}</td>
        <td class="text-center">{{result.num_correct}}</td>
        <td class="text-center">{{result.get_score|floatformat:1}}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <h6 class="text-center">Không có dữ liệu <i class="fa-solid fa-face-sad-tear"></i></h6>
  {% endif %}
</div>
{% endblock main %}

{% block style %}
<style>
  .container {
    max-width: 900px;
  }

  .btn-outline-primary {
    --bs-btn-hover-bg: #fff;
    --bs-btn-hover-color: #0d6efd;
  }
</style>
{% endblock style %}

{% block script %}
<script>
  document.getElementById('class_room_{{class_room__id}}').selected = true
  document.getElementById('contest_{{contest__id}}').selected = true

  let sortByPointBtn = document.getElementById('sortByPointBtn')
  let sortByPointInput = document.getElementById('sortByPointInput')
  let IsSortByPoint = '{{sort_by_point}}' === 'True'

  sortByPointBtn.classList.add(IsSortByPoint ? 'btn-primary' : 'btn-outline-primary')
  sortByPointInput.value = IsSortByPoint

  sortByPointBtn.addEventListener('click', () => {
    sortByPointInput.value = !IsSortByPoint;
    document.getElementById('viewResultBtn').click();
  })
</script>
{% endblock script %}
